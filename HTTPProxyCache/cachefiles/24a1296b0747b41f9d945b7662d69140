

CONTAINER_WIDTH_PERCENTS = 61.625;
CONTAINER_HEIGHT_PERCENTS = 70.0;
FONT_SIZE_FACTOR = 0.0715;
/*containerWidth = parseFloat(window.innerWidth * (CONTAINER_WIDTH_PERCENTS / 100));
containerHeight = parseFloat(window.innerHeight * (CONTAINER_HEIGHT_PERCENTS / 100));*/
containerWidth = 1000
var containerHeightPx = window.innerHeight || document.documentElement.clientHeight;
containerHeight = parseFloat(containerHeightPx * (CONTAINER_HEIGHT_PERCENTS / 100));

diashow = new Class({
	items: {},
	impressionsCounter: 1,
	field: 'html',
	fullscreen: null,
	options: {
		nextClassName: 'diashow_right',
		previousClassName: 'diashow_left',
		counterClassName: 'diashow_center',
		containerId: 'image_container',
		legendContainerId: 'image_legend',
		containerClassName: 'inlineGallery standalone',
		innerContainerClassName: 'inlineGalleryPic',
		container: null,
		title: '',
		linksHTML: '',
		buttonTagName: 'A',
		activeIndex: 0,
		touchStart: 0,
		touchEnd: 0,
		ads: {
			active: false,
			code: '',
			first: 3,
			rhythm: 5
		},
		tracker: false,
		preloadContainer: null
	},
    initialize: function(items, activeIndex){
		this.items = items;

//		this.cxTrackSlide();
		
		this.container = document.getElementById(this.options.containerId);
		//$(this.options.containerId).onclick = this.next.bind(this);
		this.options.activeIndex = activeIndex || this.options.activeIndex;
    },
	
	getActivePage: function() {
		return this.options.activeIndex + 1;
	},
	
	set: function(name, value) {
		this.options[name] = value;
	},
	
	checkKey: function(event) {
		if(!event) event = window.event;
		var keyCode = (event.which ? event.which : event.keyCode);
		if(keyCode == 39) {
			this.next();
		} else if(keyCode == 37) {
			this.previous();
		} else if(keyCode == 27 && this.container) {
			this.close();
		} else if(keyCode == 8 && this.container) {
			this.close();
			event.preventDefault();
		}
	},
	
	close: function() {
		
	},
	
	forward: function(event) {
	
		this.next();
		/*
		if(event.which == 1) {
			this.next();
		} else if(event.which == 3) {
			this.previous();
		}*/
	},

    prepare: function() {
		document.onkeydown = this.checkKey.bind(this);
		document.getElementById(this.options.containerId).onclick = this.forward.bind(this);
		this.enableFullscreen();

		try {
			document.getElementById(this.options.containerId).addEventListener("touchstart", function(e) {  
			var touch = e.changedTouches[0];  
			
			this.touchStart = touch.pageX;
			return false;
		}.bind(this), true);  
			document.getElementById(this.options.containerId).addEventListener("touchend", function(e) {  
			var touch = e.changedTouches[0];  
			
			this.touchEnd = touch.pageX;
			if(this.touchStart > this.touchEnd && (this.touchStart - this.touchEnd) > 100) {
				this.next();
				e.preventDefault();
				return false;
			} else if(this.touchEnd > this.touchStart && (this.touchEnd - this.touchStart) > 100) {
				this.previous();
				e.preventDefault();
				return false;
			}
			
			}.bind(this), true);
		}catch(e){};
		
		try {
			var nexts = document.getElementsByClassName(this.options.nextClassName);
		} catch (e){
			var nexts = $('.' + this.options.nextClassName);
		}
		for(var i = 0; i < nexts.length; i++) {
			if(nexts[i].nodeName == this.options.buttonTagName) {
				nexts[i].href = 'javascript://';
				nexts[i].onclick = this.next.bind(this);
			}
		}
		
		try {
			var previous = document.getElementsByClassName(this.options.previousClassName);
		} catch (e){
			var previous = $('.' + this.options.previousClassName);
		}
		for(var i = 0; i < previous.length; i++) {
			if(previous[i].nodeName == this.options.buttonTagName) {
				previous[i].href = 'javascript://';
				previous[i].onclick = this.previous.bind(this);
			}
		}
    },
	
	adTime: function() {
		if(this.options.ads.active == false || !this.options.ads.code) return false;
		if(this.impressionsCounter == this.options.ads.first || (this.impressionsCounter % this.options.ads.rhythm == 0 && this.impressionsCounter > this.options.ads.rhythm)) {
			return true;
		} else {
			return false;
		}
	},
	
	showAd: function() {
		if(this.options.tracker) {
			this.options.tracker((this.impressionsCounter - 1));
		}
		document.getElementById(this.options.containerId).innerHTML = '<div class="galleryAd">' + this.options.ads.code + '</div>';
		
		
	    document.getElementById(this.options.legendContainerId).innerHTML = t('Ads');
		this.impressionsCounter++;
	},

    // 130708 additional code review, done by Cxense Oslo
    cxTrackSlide: function() {

		//var console = window.console || { log: function() {} };
		//console.log('START cxense');
        
		// get all the variables for cxsense
    	if (typeof cxense_site_id === 'undefined') {cxense_site_id = '9222261986533147877'} else {cXenseSiteID = cxense_site_id}
    	var cXenseSiteID = cxense_site_id; // cxense_site_id is a global variable
        
		var diashowid = this.items[0].diashow_id;
		var activeslide = this.options.activeIndex+1;
		var lastslide = this.items.length; 
		var cxense_url = location.protocol + "//" + location.host +"/bildstrecke.html?id="+diashowid +"&page="+(activeslide);
        
		// calculate the state of this slide
		var slideshowstate = ''; // INIT
		if (activeslide === 1) {
            // mark the first slide of a slideshow
            slideshowstate = 'start';
		} else if (activeslide === lastslide) {
            // mark the last slide of a slideshow
            slideshowstate = 'end'
		} else {
            // mark all slides as in between
            slideshowstate = 'next';
		};
		        
        // make sure first, that cX.callQueue exists
    	window.cX = window.cX || {};
        cX.callQueue = cX.callQueue || [];
        cX.callQueue.push(['invoke', function() {
            cX.setSiteId(cXenseSiteID);
            cX.setCustomParameters(
                {"tam-target" : "desktop",
                "tam-cmssystem" : "nn1",
                "tam-pagetype" : "slideshow",
                "tam-slideshow" : diashowid,
                "tam-slideshowstate" : slideshowstate
            });
            cX.sendPageViewEvent({"location": cxense_url});
            cX.library.m_customParameters = [];
        }]);
		
		//console.log('END cxense-url='+cxense_url + ' | state: ' + slideshowstate + ' | slide: ' + (activeslide));
	
	},
	
    next: function() {
	
		if(this.adTime()) {
			return this.showAd();
		}

		this.cxTrackSlide();

        if(this.options.activeIndex < (this.items.length - 1)) {
			this.options.activeIndex++;
		} else {
			this.options.activeIndex = 0;
		}
        this.switchDia();
    },

    previous: function() {

		if(this.adTime()) {
			return this.showAd();
		}

		this.cxTrackSlide();

		if(this.options.activeIndex > 0) {
 			this.options.activeIndex--;
 		} else {
 			this.options.activeIndex = this.items.length - 1;
 		}
 		this.switchDia();
    },

    switchDia: function() {
		this.impressionsCounter++;
		document.getElementById(this.options.containerId).innerHTML = this.items[this.options.activeIndex][this.field];
		this.calculateImageDimensions(document.getElementById(this.options.containerId).firstChild, this.items[this.options.activeIndex]);
		document.getElementById(this.options.legendContainerId).innerHTML = this.items[this.options.activeIndex].legend; 
		try {
			var counters = document.getElementsByClassName(this.options.counterClassName);
		} catch (e){
			var counters = $('.' + this.options.counterClassName);
		}
		if(counters.length) {
			for(var i = 0; i < counters.length; i++) {
				counters[i].innerHTML = (this.options.activeIndex + 1) + '/' + this.items.length;
			}
		}
		if(this.options.tracker) {
			this.options.tracker((this.impressionsCounter - 1));
		}
		if(document.getElementById('linkUrl') && this.items[this.options.activeIndex].link_url && this.items[this.options.activeIndex].link_title) {
			document.getElementById('linkUrl').innerHTML = this.items[this.options.activeIndex].link_title;
			document.getElementById('linkUrl').href = this.items[this.options.activeIndex].link_url;
		}
		else if(document.getElementById('linkUrl')) {
			document.getElementById('linkUrl').innerHTML = "";
		}
//		if(document.getElementById('linkUrlInline') && this.items[this.options.activeIndex].link_url && this.items[this.options.activeIndex].link_title) {
//			document.getElementById('linkUrlInline').innerHTML = this.items[this.options.activeIndex].link_title;
//			document.getElementById('linkUrlInline').href = this.items[this.options.activeIndex].link_url;
//			document.getElementById('linkUrlInline').style.display = 'block';
//		}
//		else if(document.getElementById('linkUrlInline')) {
//			document.getElementById('linkUrlInline').innerHTML = "";
//			document.getElementById('linkUrlInline').style.display = 'none';
//		}
		 
		/* Ugly has to be fixed sometime */
		if(this.items[this.options.activeIndex].type == 'image' && document.getElementById('bildstreckeButtonFullScreen')) {
			document.getElementById('bildstreckeButtonFullScreen').style.visibility = 'visible';
		} else if(document.getElementById('bildstreckeButtonFullScreen')) {
			document.getElementById('bildstreckeButtonFullScreen').style.visibility = 'hidden';
		}
		this.enableFullscreen();
    },
	
	calculateImageDimensions: function() {
	},
	
	enableFullscreen: function() {
		window.onresize = function() {
			try {
				this.calculateImageDimensions(document.getElementById(this.options.containerId).firstChild, this.items[this.options.activeIndex]);
			} catch(e) {
				
			}
		}.bind(this);
		if(document.getElementById('bildstreckeButtonFullScreen')) {
			try {
				if (!$('#' + this.options.containerId).parent().find('#bildstreckeButtonFullScreen').length) 
					return false;
			} catch (e){};
			document.getElementById('bildstreckeButtonFullScreen').style.visibility = 'visible';
			document.getElementById('bildstreckeButtonFullScreen').href = 'javascript://';
			document.getElementById(this.options.containerId).onclick = this.openFullscreen.bind(this);
			document.getElementById('bildstreckeButtonFullScreen').onclick = this.openFullscreen.bind(this);
		}
	},
	
	openFullscreen: function() {
		if($('div.fullscreen').length) return false;

		this.fullscreen = new diashowFullscreen($.extend(true, [], this.items), this.options.activeIndex);
		this.fullscreen.set('title', this.items[0].diashow_title);
		this.fullscreen.set('linksHTML', this.options.linksHTML);
		this.fullscreen.fullscreen = true;
		this.fullscreen.dispatch();
	},
	
	createContainer: function(parent) {
	    this.hideAds();
	    var parent = parent || null;
	    this.options.containerClassName += ' transitionGrowLow fullscreen';
	    var container = new Element('div', {'class': this.options.containerClassName});
	    this.container = container;
	    container.inject(parent ? parent : document.body);
	    
	    /*
	      <div style="text-align: left; opacity: 1; color: rgb(255, 255, 255); width: 47.563em; font-size: 1.143em; background: none repeat scroll 0% 0% transparent; font-weight: bold; position: relative; margin: auto; height: 3em; padding-right: 15em" class="">Das junge Berner Model kann man bald auf mehreren Seiten der US-Mode-Bibel «Vogue» bestaunen. <p></p></div>
	      
	    */
	    var innerContainer = new Element('div', {'class': this.options.innerContainerClassName, 'id': this.options.containerId, 'html': this.items[this.options.activeIndex][this.field]});
	    innerContainer.inject(container);
	    
	    this.calculateImageDimensions(innerContainer.firstChild, this.items[this.options.activeIndex]);
	    if(this.items[this.options.activeIndex].diashow_subtitle) {
		var lead = this.items[this.options.activeIndex].diashow_subtitle;
		lead = lead.length > 165 ? lead.substr(0, 165) + '...'  : lead;
		var subtitle = new Element('div', {'class': 'subtitle', 'html': lead});
		subtitle.inject(container, 'top');
	    }
	    
	    var title = new Element('h2', {'html': this.options.title.length > 65 ? this.options.title.substr(0, 65) + '...'  : this.options.title});
	    title.inject(container, 'top');
	    
	    
		
	    var close = new Element('a', {'html': t('close'), 'href': 'javascript://'});
	    close.inject(title);
	    close.onclick = this.close.bind(this);
	    
	    var captionWrapper = new Element('div', {'class': 'captionWrapper'});
	    captionWrapper.inject(container);
	    
	    var caption = new Element('p', {'class': 'caption'});
	    caption.inject(captionWrapper);
	    
	    var counter = new Element('span', {'class': 'counter ' + this.options.counterClassName, 'html': this.options.activeIndex + 1 + '/' + this.items.length});
	    counter.inject(caption);
	    
	    if(this.items[this.options.activeIndex].provider_id == 9) {
		var leserReporter = new Element('span', {'class': 'leserReporter', 'html': ' '});
		leserReporter.inject(caption);
	    }
	    
	    var legend = new Element('span', {'class': 'captionCopy', 'id': this.options.legendContainerId, 'html': this.items[this.options.activeIndex].legend});
	    legend.inject(caption);
	    
	    var navi = new Element('div', {'id': 'articleGalleryNav'});
	    navi.inject(captionWrapper);
	    var previous = new Element('a', {
		'class': 'navLeft ' + this.options.previousClassName,
		'href': 'javascript://',
		'html': '&nbsp;'
	    });
	    previous.inject(navi);
	    var next = new Element('a', {
		'class': 'navRight ' + this.options.nextClassName,
		'href': 'javascript://',
		'html': '&nbsp;'
	    });
	    next.inject(navi);
	    if(window.location.host.indexOf('radio24') < 0) {
		var more = new Element('div', {'class': 'captionMore', 'style': 'text-align: left'});//.setStyles({'text-align':'left'}); 
		more.inject(captionWrapper);

		// SOCIAL NETWORKS 
		var body = document.getElementsByTagName('body')[0];
		var socialsDiv = new Element('div', {'class': 'diashowLinksWrapper', 'id': 'diashowSocialsWrapper', 'width':'600px', 'html': ''}).inject(more);
		// URL parsing to include id
		var url = window.location.href;
		if (url.indexOf('?')<0) url += '?';
		else url = url.replace(/&?id=[^&#]{0,}/,'');//Kill stored 'id' argument ...
		url += (url.indexOf('?')==url.length-1) ? 'id='+this.options.diashow_id : '&id='+this.options.diashow_id;
		// Localization: use url
		window.langloc  =  (url.indexOf('lematin')>-1 || url.indexOf('24heures')>-1 || url.indexOf('tdg')>-1) ? 'fr_FR' : 'de_DE';

		// Google +1
		// BUG with IE. Display for other browsers ...
		if (window.navigator && navigator.appName!=='Microsoft Internet Explorer') {
		    var googleBtn = new Element('g:plusone',{size: 'medium', href: url}).inject(socialsDiv);
		    $.ajax({ url: 'https://apis.google.com/js/plusone.js', dataType: 'script', cache:true, 'async': true});
		}

		// Twitter 
		var twBtn = new Element('a',{
		    'href':"https://twitter.com/share", 
		    'class': "twitter-share-button",
		    'data-lang': "en", 
		    'data-url': url,
		    'data-text': this.options.title,
		    'html': ""}).inject(socialsDiv);
		$.ajax({ url: 'http://platform.twitter.com/widgets.js', dataType: 'script', cache:false});

		// Facebook		    
		// use css to hide comment box ...
		var css =  '.fb_edge_widget_with_comment span.fb_edge_comment_widget iframe.fb_ltr {display: none !important }';
		var fbCss = new Element('style',{type: "text/css"});
		document.getElementsByTagName('head')[0].appendChild(fbCss);
		if (fbCss.styleSheet) {
		    fbCss.styleSheet.cssText = css;
		} else {
		    fbCss.appendChild(document.createTextNode(css));
		}
		
		if (!$('fb-root')) var fbRDiv = new Element('div',{'id': 'fb-root', 'html': ''}).inject(document.getElementsByTagName('body')[0],'top');

		var fbBtn = new Element('div',{
		    'class': 'fb-like',
		    'data-href': url ,
		    'data-send': 'false',
		    'data-layout': 'button_count',
		    'data-width': 450,
		    'data-show-faces': 'false',
		    'data-action': 'recommend',
		    'style': "vertical-align: top"
		}).inject(socialsDiv);
		
		var fbJS = new Element('script',{type: "text/javascript"});
		
		var js = '!function(d, s, id, loc) {var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/"+loc+"/all.js#xfbml=1";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk", window.langloc)';
		if (fbJS.canHaveChildren == null || fbJS.canHaveChildren) {
		    fbJS.appendChild(document.createTextNode(js));
		} else {
		    fbJS.text =  js;
		}
		fbJS.inject(socialsDiv);
		
		// Links
		var linksSpan = new Element('span', {'class': 'diashowLinksWrapper', 'id': 'diashowLinksWrapper', 'html': ''});
		linksSpan.inject(more);
		
		var links = new Element('a', {
		    'id': 'linkUrl',
		    'class': 'captionLeft iconArticle diashowLink'
		});
		
		links.inject(linksSpan);
		
		
		if(this.items[this.options.activeIndex].link_url && this.items[this.options.activeIndex].link_title) {
		    links.innerHTML = this.items[this.options.activeIndex].link_title;
		    links.href = this.items[this.options.activeIndex].link_url;
		}
		linksSpan.innerHTML = linksSpan.innerHTML + this.options.linksHTML;
		
		if(this.items[this.options.activeIndex].ressort_url) {
		    var moreDsHref = this.items[this.options.activeIndex].ressort_url; 
		    // exceptions for ZOL, AVU, Regio: always link to diashow overview 
		    rexp1 = /zol\.ch/gi; 
		    rexp2 = /avu\.ch/gi; 
		    rexp3 = /regio\.ch/gi; 
		    if(rexp1.test(location.href) || rexp2.test(location.href) || rexp3.test(location.href))  {
			moreDsHref = '/bildstrecke.html';
		    }
		    var moreDiashows = new Element('a', {'class': 'captionRight iconImage', 'href': moreDsHref, 'html': t('more galleries')});
		    moreDiashows.inject(more);
		}	
	    }
	    
	    if(typeof(WEMF) != 'undefined' && typeof(pageTracker) != 'undefined') {
		var wemf = new Element('div', {'id': 'articleGalleryWemf_' + this.items[0].diashow_id});
		wemf.inject(navi);
		var tracker = function(counter) {

			var pathArray = window.location.pathname.split( '/' );
			var channel = pathArray[1];
		    var title_analytics= this.options.title;
		    title_analytics = title_analytics.replace(/ /g, '-');

		    if(counter > 0){
			document.getElementById("articleGalleryWemf_" + this.items[0].diashow_id).innerHTML = "<img src='"+WEMF+channel+"/bildstrecke_inline?r="+escape(document.referrer)+"&d="+(Math.random()*100000)+"' width='1' height='1' alt='' /><img src='"+WEMF2+channel+"/bildstrecke_inline?r="+escape(document.referrer)+"&d="+(Math.random()*100000)+"' width='1' height='1' alt='' />"
			pageTracker._trackPageview("Gallery/" + title_analytics);
			secondTracker._trackPageview("Gallery/" + title_analytics); 
			//if(counter == 1) {
			    document.getElementById('articleGalleryWemf_' + this.items[0].diashow_id).innerHTML += '<img src="/bildstrecke/' + this.items[0].diashow_id + '/pixel.gif?nocache=1280733869" width="1" height="1" />';
			//}
			
		    }
		}.bind(this);
		this.set('tracker', tracker);
	    }
	},
	
	preload: function() {
		
		if(!this.options.preloadContainer) {
			this.options.preloadContainer = document.createElement('div');
			document.getElementById(this.options.containerId).parentNode.appendChild(this.options.preloadContainer);
			this.options.preloadContainer.style.display = 'none';
		}
		
		if(this.impressionsCounter == 1 || this.impressionsCounter % 5 == 0) {
			
			for(var i = 0; i < 5; i++) {
				if(typeof(this.items[this.options.activeIndex + i]) != 'undefined') {
					this.options.preloadContainer.innerHTML += this.items[this.options.activeIndex + i][this.field];
				}
			}
		}
		
	},

    dispatch: function() {
        this.prepare();
    }
});

var diashowFullscreen = new Class({
	Extends: diashow,
	field: 'html',
	dispatch: function() {
		this.impressionsCounter++;
		if(this.options.tracker) {
			this.options.tracker((this.impressionsCounter - 1));
		}

		this.resetOldStyles();
		this.createContainer();
		this.parent();
		this.hideAds();
		$('div.fullscreen').click(function(e){
			var element = e.srcElement ? e.srcElement : e.target;
			if(element && $(element).hasClass('fullscreen')) {
				this.close();
			}
		}.bind(this));
		this.container.removeClass('transitionGrowLow');
		if(this.options.tracker) {
			this.options.tracker((this.impressionsCounter - 1));
		}
	},
	
	resetOldStyles: function() {
		this.items = $.extend(true, [], this.items);
		for(var i = 0; i < this.items.length; i++) {
			this.items[i].html = this.items[i].html.replace(/style\=\"[^\"]+\"/, '');
		}
	},
	
	resizeImage: function() {
		var data = this.items[this.options.activeIndex];
		if((data.type == 'code' || data.type == 'video' ) && data.html.indexOf('iframe') > -1) {
			data.html = data.html.replace(/width\=\&/, 'width=' + containerWidth);
			data.html = data.html.replace(/height\=\&/, '&height=' + containerHeight);
		}
	},
	
	calculateImageDimensions: function(element, data) {
		var width = 0;
		var height = 0;
		
		if(data.type == 'image') {
			var imageWidth = parseFloat(data.width);
			var imageHeight = parseFloat(data.height);
			var marginTop = 0;
			
			
			if(imageWidth >= containerWidth || imageHeight >= containerHeight) {
				if(imageWidth > imageHeight && containerWidth > imageWidth) {
					width = containerWidth;
					//height = imageHeight * (imageWidth > containerWidth ? imageWidth / containerWidth  : containerWidth / imageWidth);
					height = imageHeight * containerWidth / imageWidth;
				} else if(imageWidth < imageHeight && containerHeight > imageHeight) {
					height = containerHeight;
					width = imageWidth * (containerHeight / imageHeight);
				} else if(imageWidth > imageHeight & containerWidth < imageWidth) {
					width = containerWidth;
					height = imageHeight * (containerWidth / imageWidth);
				} else if(imageWidth < imageHeight & containerHeight < imageHeight) {
					height = containerHeight;
					width = imageWidth * (containerHeight / imageHeight);
				}
				
				if(width > containerWidth) {
					height = height * (containerWidth / width);
					width = containerWidth;
				} else if(height > containerHeight) {
					width = width * (containerHeight / height);
					height = containerHeight;
				}
			}
			
			if(width == 0 || height == 0) {
				width = imageWidth;
				height = imageHeight;
			}

			if(height && height < containerHeight) {
				marginTop = (containerHeight - height) / 2 * FONT_SIZE_FACTOR  + 'em';
			}
		
		} else {
			width = containerWidth;
			height = containerHeight;
		}
		
		width = FONT_SIZE_FACTOR * width;
		height = FONT_SIZE_FACTOR * height;
		
		if(element) {
			if(width) $(element).css('width', width + 'em');
			if(height) $(element).css('height', height + 'em');
			$(element).css('marginTop', marginTop);
		}
		
		//console.log(containerWidth + '-' + width, containerHeight + '-' + height);
	},
	
	showAds: function() {
		if( document.getElementById('adtopBanner') && $('#adtopBanner').css('display') != 'none' ) $('#adtopBanner').show();
		if(document.getElementById('sidebarSky'))  $('#sidebarSky').show();
		if(document.getElementById('colRightAd'))  $('#colRightAd').show();
		if($('.videoBox').length)$('.videoBox').show();
		$('iframe').show();
	},
	
	hideAds: function() {
		this.resizeImage();
		if( document.getElementById('adtopBanner') && $('#adtopBanner').css('display') != 'none' ) $('#adtopBanner').hide();
		if(document.getElementById('sidebarSky'))  $('#sidebarSky').hide();
		if(document.getElementById('colRightAd'))  $('#colRightAd').hide();
		if($('.videoBox').length)$('.videoBox').hide();
		$('iframe').hide();
		$('#' + this.options.containerId + ' iframe').show();
		
		if(document.getElementById(this.options.containerId)) {
			if (document.getElementById(this.options.containerId).touchstart) {
				document.getElementById(this.options.containerId).addEventListener("touchstart", function(e){
					e.preventDefault();
				}, false);
			}
		}
	},
	
	switchDia: function() {
		this.resizeImage();
		this.preload();
		this.parent();
	},
	
	close: function() {
		var channellocal = (typeof channel === 'undefined') ? '' : channel;
		
		document.getElementById("articleGalleryWemf_" + this.items[0].diashow_id).innerHTML = "<img src='"+WEMF+channellocal+"/bildstrecke_inline/close?r="+escape(document.referrer)+"&d="+(Math.random()*100000)+"' width='1' height='1' alt='' /><img src='"+WEMF2+channellocal+"/bildstrecke_inline/close?r="+escape(document.referrer)+"&d="+(Math.random()*100000)+"' width='1' height='1' alt='' />"
		this.showAds();
		this.container.parentNode.removeChild(this.container);
		this.fullscreen = null;
	}
});